# 02-3 CPU
### ✅레지스터
CPU 안에 있는 작은 임시 저장장치

- CPU 안에는 다양한 레지스터들이 있고, 각기 다른 이름과 역할
- 프로그램을 이루는 데이터와 명령어가 프로그램의 실행 전후로 레지스터에 저장
- 레지스터는 WinDbg(윈도우), gdb(리눅스,맥) 등의 디버깅 도구를 이용해 관찰

▶️ **주요 레지스터**
1. 프로그램 카운터(PC)
- 메모리에서 다음으로 읽어 들일 명령어의 주소를 저장
- PC를 명령어 포인터(Instruction Pointer)라고 부루는 CPU도 있음
- 일반적으로 PC는 1씩 증가, 이는 곧 다음으로 읽어 들일 메모리 주소가 1씩 증가하는 것과 같음

 2. 명령어 레지스터 (IR, Instruction)
- 해석할 명령어, 즉 메모리에서 방금 읽어 들인 명령어를 저장
- CPU내의 저장장치는 명령어 레지스터 속 명령어를 해석한 뒤 ALU로 하여금 연산하도록 시키거나 다른 부품으로 제어 신호를 보내 해당 부품을 작동시킴

3. 범용 레지스터(general purpose)
- 일반적인 상황에서 자유롭게 사용할 수 있는 레지스터
- 데이터와 명령어, 주소 모두를 저장할 수 있음
- CPU 안에는 여러 개의 범용 레지스터들이 있음

4. 플래그 레지스터
- 연산의 결과 혹은 CPU 상태에 대한 부가 정보인 flag값을 저장

5. 스택 포인터
- 메모리 내 스택 영역의 최상단 스택 데이터 위치를 가리키는 특별한 레지스터

<hr>

### ✅인터럽트 
CPU의 작업을 방해하는 신호
- 동기 인터럽트(or **예외**) : CPU에 의해 발생
- 비동기 인터럽트(or **하드웨어 인터럽트**) : 주로 입출력장치에 의해 발생

▶️ **하드웨어 인터럽트**

CPU는 효율적으로 명령어를 처리하기 위해 하드웨어 인터럽트를 사용
- 처리 순서
    1. 입출력장치는 CPU에게 **인터럽트 요청 신호**를 보냄
    2. CPU는 실행 사이클이 끝나고 명령어를 인출하기 전에 항상 인터럽트 여부를 확인
    3. CPU는 인터럽트 요청을 확인하고, **인터럽트 플래그**를 통해 현재 인터럽트를 받아들일 수 있는지 여부를 확인
    4. 인터럽트를 받아들일 수 있다면 CPU가 지금까지의 작업을 백업
    5. CPU는 **인터럽트 벡터**를 참조하여 **인터럽트 서비스 루틴**을 실행
    6. 인터럽트 서비스 루틴 실행이 끝나면 4번에서 백업해 둔 작업을 복구하여 실행을 재개
 
**인터럽트 요청 신호** <br>
인터럽트는 CPU의 정상적인 실행 흐름을 끊는 것이기 때문에 인터럽트 하기 전에 CPU에게 인터럽트의 가능 여부를 확인

**인터럽트 플래그** <br>
CPU가 인터럽트 요청을 수용하기 위해서는 플래그 레지스터가 활성화되어 있어야 함<br>
인터럽트 플래그는 하드웨어 인터럽트를 받아들일지, 무시할지를 결정하는 플래그<br>
만약 인터럽트 플래그가 불가능으로 설정되어 있다면 CPU는 인터럽트 요청이 오더라도 해당 요청을 무시

- 비동기 인터럽트
  - 막을 수 있는
  - 막을 수 없는(Non Maskable Interupt)

**인터럽트 서비스 루틴(ISR)** <br>
CPU가 인터럽트 요청을 받아들이기로 했다면 CPU는 ISR을 실행<br>
ISR은 인터럽트를 처리하기 위한 프로그램으로, 인터럽트 핸들러라고도 함<br>
CPU가 인터럽트를 처리 = ISR을 처리하고, 본래 수행하던 작업으로 다시 되돌아온다는 의미

**인터럽트 벡터** <br>
ISR을 식별하기 위한 정보<br>
CPU가 인터럽트를 처리 - ISR을 실행하고, 본래 수행하던 작업으로 다시 되돌아옴<br>
CPU가 ISR을 실행하려면 ISR의 시작 주소를 알아야함 <br>
`인출` ← `인터럽트` ←인터럽트가 발생한 경우 - `실행`


▶️ **예외**
- 종류 : 폴트, 트랩, 중단, 소프트웨어 인터럽트 등

CPU는 예외가 발생하면 하던 일을 중단하고 해당 예외를 처리<br>
예외를 처리하고 나면 다시 본래 하던 작업으로 되돌아와 실행을 재개<br>
CPU가 본래 하던 작업으로 되돌아왔을 때
  - 폴트 - 예외가 발생한 명령어부터 실행
  - 트랩 - 예외가 발생한 명령어의 다음 명령어부터 실행 ex) 디버깅의 브레이크 포인트
 
<hr>

### ✅성능 향상

<hr> 

### ✅파이프라이닝 

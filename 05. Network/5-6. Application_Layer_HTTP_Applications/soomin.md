# 5-6. 응용 계층 - HTTP의 응용
## ✅쿠키
- HTTP는 스테이트리스 → 요청 메시지는 모두 독립된 메시지로 간주
- BUT, '3일간 보지 않기' 어떻게 가능? 쿠키로 해결
- 서버에서 생성되어 클라이언트 층에 저장되는 데이터 - <이름,값>
- 브라우저에서 확인 가능 
- 서버 → 클라이언트 : 응답 - Set-Cookie: 이름=값; 속성1; 속성2
  - 쿠키의 대표적 속성들
    - domain & path - 쿠키를 전송할 도메인과 경로 제한
    - Secure - HTTPS를 통해서만 쿠키 송수신
    - HttpOnly - 자바스크립트를 통한 쿠키 접근 제한
- 서버 ← 클라이언트 : 요청 - Cookie: 이름=값; 이름=값;
  - 특정 서버로부터 전달 받았다면, 해당 서버에 요청 보낼 때 자동 쿠키 전송

#### 🔷웹 스토리지: 로컬 스토리지와 세션 스토리지
- 쿠키 이외에도 웹스토리지로 클라이언트 상태 추축 가능
- 쿠키보다 더 큰 데이터 저장
- 쿠키는 서버로 자동 전송, 웹 스토리지는 X
- 로컬 - 별도 삭제아닌 이상 영구적
- 세션 - 브라우저가 열려 있는 동안 유지되는 정보

## ✅캐시
- 응답받은 자원의 사본을 임시 저장하여 불필요한 대역폭 낭비와 응답 지연을 방지하는 기술
- 클라이언트에 저장 - 개인 전용 캐시
- 클라이언트와 서버 사이의 중간 서버에 저장 - 공용 캐시
- 대부분 캐시된 데이터에는 유효 기간 설정 
  - Expires - 만료 날짜
  - Cache Control: max-age - 사용 가능한 초 단위 시간 
- 왜 유효 기간 부여? 서버의 원본 데이터가 변경되어 일관성 깨질 수 있어서
- 캐시 신선도 - 캐시된 사본과 서버의 원본이 얼마나 유사한지 정도 
- 클라이언트는 캐시된 자원의 유효 기간이 만료되었을 때
  - 서버에게 원본 자원이 변경된 적이 있는지 질의
  - 서버의 응답에 따라
    - 유효 기간 연장
    - 새로운 자원 응답
- 질의 방법
  - 날짜 기반 - If-Modified-Since
    - **서버 입장**
      - 자원 변경 - 200(ok)과 함께 새로운 자원 반환
      - 자원 변경x - 304(Not Modified)와 함께 Last-Modified 헤더로 자원의 마지막 변경 시점 알림
        - 304(Not Modified): 캐시된 자원을 참조하라
      - 자원 삭제 - 404(Not Found)
  - 엔티티 태그 기반 - Etag : 자원의 버전 식별
    - 자원 변경될 때마다 Etag값 변경 
    - 변경되지 않으면 Etag값 그대로
    - If-None-Math : 요청할 자원에 대한 Etag값 명시
      - 명시된 Etag값과 일치하는 Etag가 없을때만 변경된 자원으로 응답하도록 서버에게 요청
      - 날짜 기반의 **서버 입장**과 동일
  
## ✅콘텐츠 협상
- 클라이언트와 서버가 HTTP 메시지를 통해 주고받는 건 '자원의 표현'
- 표현: 송수신 가능한 자원의 형태
- 같은 URI라도 다른 자원의 표현이 있음
  - GET의 정확한 목적은 자원 조회 보다 자원의 특정 표현 조회에 가까움
- 콘텐츠 협상 - 클라이언트가 가장 적합한 자원의 표현을 제공하는 기술 
- 대표 헤더
  - Accept: 선호하는 미디어 타입을 나타내는 헤더
  - Accept-Language: 선호하는 언어
  - Accept-Encoding: 선호하는 인코딩 방식 
- 클라이언트가 우선순위 반영한 표현 선호도를 담은 요청 메시지 보낼 수 있음
- 이러한 우선순위는 콘텐츠 협상 관련 헤더의 q값으로 표현 - Quality Value 0~1


## ✅보안: SSL/TLS와 HTTPS
- HTTPS - HTTP에 SSL 혹은 TLS 프로토콜 동작이 추가된 프로토콜
- TLS(Transport Layer Security) - SSL(Secure Socket Layer)을 계승


- TLS 1.3 기반 HTTPS 메시지 송수신 단계
1. TCP 쓰리 웨이 핸드셰이크
2. **TLS 핸드셰이크** - HTTP와 달리 추가 → 메시지 암호화가 이루어짐
3. 메시지 송수신

- TLS 핸드셰이크
  - TLS 핸드셰이크를 통해 암호화 통신을 위한 키를 생성/교환
    - 암호 스위트 - 암호화 알고리즘과 해시 함수의 종류
  - 인증서 송수신과 검증 이루어짐 
    - 인증서 - '당신이 통신을 주고받는 상대방은 틀림없이 당신이 의도한 대상이 맞다' 입증
    - 송수신 당사자가X, 제 3의 기관이 보장해야 의미 있음
    - CA - 인증서의 발급과 검증, 저장 등의 역할을 수행하는 공인 기관
    

# 5-7. 프록시와 안정적인 트래픽
## ✅오리진 서버와 중간 서버: 포워드 프록시와 리버스 프록시
- 오리진 서버: 자원을 생성하고 클라이언트에게 권한이 있는 응답을 보낼 수 있는 HTTP 서버
- 클라이언트 서버와 오리진 서버 사이에 많은 중간 서버들

#### 중간서버
대표 유형: 프록시(=포워드 프록시), 게이트웨이(=리버스 프록시)
- 프록시 → 클라이언트와 가깝
  - 클라이언트의 심부름꾼 또는 대리인 
- 게이트 웨이 → 오리진 서버와 가깝
  - 오리진 서버로 향하는 요청 메시지 먼저 받는 경비, 문지기 역할 
  - 클라이언트의 시각에서 게이트웨이가 오리진 서버처럼 보임
## ✅고가용성: 로드 밸런싱과 스케일링
- 가용성 & 부하 분산 ⇒ 안전성과 관련
### ▶️가용성
주어진 특정 기능을 실제로 수행할 수 있는 시간의 비율
- 업타임 - 정상적인 사용 시간
- 다운타임 - 정상적인 사용이 불가능한 시간 
- 가용성 = 업타입/(업타임+다운타임)
- 고가용성 - 전체 사용시간 중 대부분 사용 가능 

고가용성 유지의 핵심
- 애초에 문제가 발생하지 않도록 하는 것X
- 문제가 발생하더라도 계속 가능할 수 있도록(→결함 감내) 설계하는 것 ⇒ 다중화 기술

#### 🔷헬스 체크와 하트비트
서버 문제 발생 → 다른 서버 어떻게 감지? 주기적으로 검사
  - 헬스 체크 - 로드 밸런서가
  - 하트비트 - 서버간 주기적 메시지 교환

### ▶️로드 밸런싱
- 다중화 했다고 고가용성이 보장?X
- 서버 가용성의 가장 큰 영향 - 감당하기 어려운 트래픽
- 다중화하더라도 트랙픽이 고르게 분산되지 않으면 가용성↓

하나 이상의 서버가 트래픽을 어떻게 고르게 분산하여 수신할지 고려하기
- 로드 밸런싱 - 트래픽의 고른 분배를 위해 사용되는 기술
  - 로드밸런서에 의해 수행
    - 다중화된 서버와 클라이언트 사이에 위치
    - 클라이언트의 요청을 균등하게 분배
  - 대표 SW: HaProxy, Envoy, Nginx
- 로드 밸런싱 알고리즘 - 요청 전달할 서버가 여러 개일 때 결정하는 방법
  - 라운드 로빈 알고리즘 - 단순히 서버 돌아가며 부하 전달
  - 최소 연결 알고리즘 - 연결이 적은 서버부터 우선적으로 부하 전달

모든 서버의 성능이 동일하지 않으면? 
- 성능이 더 좋은 서버에 더 많은 트랙픽 분배
- 로드 밸런싱 알고리즘에 가중치 부여 

### ▶️스케일링: 스케일 업 스케일 아웃 오토스케일링
- 스케일 업: 기존 부품을 더 나은 사양으로 교체 → 수직적 확장
  - 설치와 구성의 단순함
- 스케일 아웃: 기존 부품을 여러 개로 → 수평적 확장
  - 유연한 확징 및 축소 가능
  - 결함을 감내하기 용이 - 고장난 장비의 역할 대신 수행 가능
#### 🔷오토스케일링
- 특정 기간 동안 트래픽 급중할 때만 동적으로 확장 & 축소
- 자원을 더욱 경제적이고, 탄력적으로 이용 가능 

## ✅Nginx로 알아보는 로드 밸런싱
- 포워드 프록시나 리버스 프록시 기능 제공 → 로드 밸런싱 가능
Nginx 설치시 중요 3가지
1. ${nginx}/nginx.conf 파일 - 가장 기본적인 설정 파일이자 모든 설정들의 시작점
2. ${nginx}/log/nginx/디렉터리 - nginx 관련 로그 저장
3. ${nginx}/conf.d/디렉터리 - 각종 설정 파일들 포함

#### 🔷업스트림/다운스트림과 인바운드/아웃바운드
- 업스트림 - 클라이언트 → 오리진 서버
- 다운스트림 - 클라이언트 ← 오리진 서버
- 인바운드 - NW 외부 → 내부
- 아웃바운드 NW 외부 ← 내부

# 2. 프로세스와 스레드

메모리에는 다양한 프로세스들이 적재되어 실행됩니다. 이때 프로세스는 크게 포그라운드 프로세스와 백그라운드 프로세스로 나눌 수 있습니다.

## 프로세스 유형
### 포그라운드 프로세스 (foreground process)
- 사용자와 상호작용하며 실행
- 사용자가 보는 화면에서 실행되는 프로세스

### 백그라운드 프로세스 (background process)
- 사용자와 상호작용하지 않으며, 사용자가 보지 않는 곳에서 실행
- 주어진 작업만 수행하는 프로세스
- **데몬** : 사용자와 상호작용하지 않으며 시스템 작업을 수행하는 특별한 백그라운드 프로세스
  - 윈도우 운영체제에서는 데몬을 서비스라고 칭함

## 프로세스 메모리 구조
프로세스는 다음과 같은 메모리 영역으로 구성됩니다:

- **커널 영역**: 프로세스 제어 블록(PCB)이 저장되는 공간
- **사용자 영역**: 실행 중인 프로세스의 코드, 데이터, 힙, 스택 등이 저장되는 공간

### 코드 영역 (텍스트 영역)
- 실행 가능한 명령어가 저장되는 공간
- 읽기 전용으로, CPU가 실행할 명령어를 포함

### 데이터 영역
- 프로그램 실행 도중 유지할 데이터가 저장되는 공간
- 주로 **정적 변수**와 **전역 변수**가 저장됨

### 힙 영역
- 동적으로 메모리를 할당하는 공간
- 개발자가 직접 메모리 할당 및 해제를 수행
- 메모리를 해제하지 않으면 **메모리 누수** 발생 가능
  - 일부 프로그래밍 언어에서는 가비지 컬렉션을 통해 자동으로 메모리를 해제함

### 스택 영역
- 일시적으로 필요한 값들을 저장하는 공간
- **매개변수**, **지역 변수**, **함수 복귀 주소** 등이 저장됨
- **스택 트레이스**: 디버깅을 위해 함수 호출 정보를 저장

## PCB와 문맥 교환

운영체제는 여러 프로세스를 관리하기 위해 각 프로세스에 대한 정보를 담은 **프로세스 제어 블록(PCB)**을 사용합니다.

### PCB의 구성
- **프로세스 ID(PID)**: 프로세스를 식별하는 번호
- **레지스터 값**: 프로세스가 실행 중에 사용한 레지스터 값
- **프로세스 상태**: 현재 프로세스의 상태
- **CPU 스케줄링 정보**: 우선순위 및 CPU 할당 순서
- **메모리 관련 정보**: 프로세스가 사용 중인 메모리 영역 정보
- **입출력 장치 관련 정보**: 입출력 장치 상태 정보

### 문맥 교환 (Context Switch)
- CPU에서 프로세스를 실행할 때, 각 프로세스의 상태를 저장하고 새로운 프로세스를 실행하는 과정
- **문맥**: 프로세스 수행을 재개하기 위한 정보
- 문맥 교환은 **타이머 인터럽트**로 발생하며, 이때 현재 프로세스의 상태를 PCB에 백업하고, 새로운 프로세스의 PCB에서 상태를 복구하여 실행

## 프로세스 상태
프로세스는 여러 가지 상태로 나뉜다.

- **생성 상태 (new)**: 프로세스가 생성 중이고, 메모리에 적재되어 PCB를 할당받은 상태
- **준비 상태 (ready)**: CPU를 할당받을 준비가 된 상태
  - 준비 상태에서 실행 상태로 전환되는 과정은 **디스패치(dispatch)**라고 함
- **실행 상태 (running)**: CPU를 할당받아 실행 중인 상태
  - 일정 시간이 지나면 타이머 인터럽트가 발생해 다시 준비 상태로 돌아감
- **대기 상태 (blocked)**: 입출력 작업이나 자원 요청으로 인해 실행이 불가능한 상태
- **종료 상태 (terminated)**: 프로세스 실행이 끝난 상태, 메모리와 PCB가 정리됨

## 멀티 프로세스와 멀티 스레드

### 멀티 프로세스
- 여러 프로세스를 동시에 실행하는 방식
- 각 프로세스는 독립적으로 실행되고 자원을 공유하지 않음
- **장점**: 한 프로세스의 문제로 다른 프로세스에 영향을 주지 않음
- **단점**: 각 프로세스가 독립적으로 자원을 사용하므로 효율적인 자원 사용에 제한이 있을 수 있음

### 멀티 스레드
- 하나의 프로세스 내에서 여러 스레드가 동시에 실행되는 방식
- 스레드들은 프로세스의 자원을 공유
- **장점**: 자원을 효율적으로 사용하고, 프로세스 간 통신이 용이
- **단점**: 하나의 스레드에서 발생한 문제는 전체 프로세스에 영향을 미침

## 프로세스 간 통신 (IPC)

### 공유 메모리
- 여러 프로세스가 동일한 메모리 공간을 공유하여 데이터를 주고받는 방식
- **장점**: 빠른 속도의 통신 가능
- **단점**: 데이터 일관성 문제 (레이스 컨디션) 발생 가능

### 메시지 전달
- 프로세스 간에 메시지를 주고받는 방식으로, 커널을 거쳐 송수신됨
- **장점**: 데이터 일관성을 유지하고, 커널의 도움을 받아 동기화 문제를 쉽게 처리
- **단점**: 공유 메모리 방식보다 속도가 느림

### 대표적인 IPC 기술
- **파이프**: 단방향 통신을 위한 도구
- **시그널**: 프로세스에게 특정 이벤트 발생을 알리는 비동기적 신호
- **원격 프로시저 호출 (RPC)**: 원격 서버에서 코드를 실행하는 방식, 주로 대규모 트래픽 환경에서 사용

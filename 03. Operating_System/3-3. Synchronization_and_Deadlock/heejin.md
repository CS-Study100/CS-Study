# 3-3 동기화와 교착 상태

## 🤔 동기화가 왜 필요할까 ?
프로세스와 스레드가 **공유 자원**에 접근할 때, **동시 실행**으로 인한 문제가 발생할 수 있다.
`레이스 컨디션(Race Condition)` 가 발생할 수 있는 문제 중 하나 !!!
이는 다수의 프로세스나 스레드가 **공유 자원**에 동시에 접근하여 예상하지 못한 결과를 초래하는 상황이다.
- 임계 구역(Critical Section) : 공유 자원에 접근하는 코드 중 동시에 실행했을 때 문제가 발생할 수 있는 코드
즉, 동시에 실행되는 프로세스나 스레드가 동시에 임계 구역에 진입하여 실행되는 문제가 발생

### ➡️ 동기화 기법으로 이러한 문제를 해결할 수 있다 !!!

# ✅ 동기화 
#### 프로세스나 스레드가 자원을 공유할 때, 동시에 접근하지 않도록 하여 실행 순서를 제어하는 방법

2가지 조건을 준수하며 실행해야한다.
1️⃣ **실행 순서 제어** : 프로세스 및 스레드를 올바른 순서로 실행하기
2️⃣ **상호 배제** : 동시에 접근해서는 안 되는 자원에 하나의 프로세스 및 스레드만 접근하기


## ☑️ 동기화 기법
### 뮤텍스 락(mutex lock) 
동시에 접근해서는 안 되는 자원에 동시 접근 불가능하도록 **상호 배제**를 보장하는 동기화 도구
`상호 배제를 위한 락(lock)`
- 뮤텍스 락의 기본 원리 :
	- 임계 구역에 접근하고자 한다면 락(lock)을 획득`acquire()`해야 한다
    - 임계 구역에서의 작업이 끝났다면 락을 해제`release()`해야 한다.
    
### 세마포(Semaphore)
뮤텍스보다 **일반화된 동기화 도구**로, 하나 이상의 프로세스가 공유 자원에 접근할 수 있는 경우에 사용
자원의 개수를 세고, 자원이 사용 가능할 때만 접근할 수 있도록 한다.
- 세마포의 기본 원리 :
	- `변수 S` 는 사용가능한 공유 자원의 개수를 나타내는 변수, 사용 가능한 공유 자원의 개수
	- `wait()` 함수는 자원을 사용하기 전에 호출하여, 자원이 없으면 대기 상태로 전환
    - `signal()` 함수는 자원 사용이 끝난 후 호출하여 자원을 반환
    
### 모니터
**조건 변수(condition variable)** : 실행 순서 제어를 위한 동기화 도구로, 특정 조건 하에 프로세스를 실행/일시 중단함으로써 프로세스나 스레드의 실행 순서를 제어 가능
- `wait()` 함수 : 조건이 충족될 때까지, 호출한 프로세스 및 스레드의 상태를 대기 상태로 전환하는 함수
- `signal()` 함수 : 조건이 충족되면, `wait()` 로 일시 중지된 프로세스 및 스레드의 실행을 재개하는 함수
**모니터(moniter) : 조건 변수와 상호 배제를 동시에 처리할 수 있는 동기화 기법**
- 공유 자원과 그 자원을 다루는 함수(인터페이스)들을 하나의 단위로 묶어두고 그 안에서만 자원에 접근하도록 제한한다.
- 프로세스가 자원에 접근하는 순서를 제어할 수 있다.
- 작동 원리 :
	- 모니터에 들어가서 실행되는 프로세스나 스레드는 한 번에 하나만 존재
	- 조건에 맞는 스레드는 모니터에 진입해 실행하고, 그렇지 않은 스레드는 대기 큐에 들어가 대기
    
    
## ☑️ 스레드 안전(thread safety)
**멀티스레드 환경에서 어떤 변수나 함수, 객체에 동시 접근이 이루어져도 실행에 문제 없는 상태를 의미 한다.**
여러 스레드에 의해 호출되어도 `레이스 컨디션` 이 발생 X


---


# ✅ 교착 상태(deadlock)
**일어나지 않을 사건을 기다리며 프로세스의 진행이 멈춰 버리는 현상**
2개 이상의 프로세스가 각자 가지고 있눈 자원을 무작정 기다린다면 더 이상 어떤 프로세스도 진행할 수 없는 교착 상태 발생 가능
## ☑️ 교착 상태의 발생 조건
4개의 조건이 모두 만족할 때 교착 상태가 발생할 **가능성이 생긴다**.

#### 1️⃣ 상호 배제
- 한 프로세스가 사용하는 자원을 다른 프로세스가 사용할 수 없는 **상호 배제**의 상황

#### 2️⃣ 점유와 대기
- 한 프로세스가 어떤 자원을 할당받은 상태(점유)에서 다은 자원 할당받기를 기다린다면(대기) 교착 상태 발생

#### 3️⃣ 비선점
- 어떤 프로세스도 다른 프로세스의 자원을 강제로 빼앗지 못하는 경우

#### 4️⃣ 원형 대기
- 각각의 프로세스가 서로 점유한 자원을 할당받기 위해 원의 형태로 대기할 경우


## ☑️ 교착 상태의 해결 방법
### 교착 상태 예방
- 교착상태를 예방하는 방법은 **교착상태를 발생시키는 4가지 필요 조건 (상호 배제, 점유와 대기, 비선점, 원형 대기) 중 하나를 충족하지 않도록** 하는 방법

### 교착 상태 회피
- 교착상태 회피는 **교착상태가 발생하지 않도록 자원 할당을 신중하게 관리**하는 방법
- 회피 기법은 자원을 어떻게 할당할지를 미리 고려하여 교착상태를 방지하는 방식

### 교착 상태 검출 후 회복
- 교착 상태가 **이미 발생한 후 이를 처리하는 방법**
	- 교착 상태가 검출되면 프로세스를 **자원 선점을 통해 회복**
	- 교착 상태에 놓인 프로세스를 **강제로 종료함으로써 회복**





